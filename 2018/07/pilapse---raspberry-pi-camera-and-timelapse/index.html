<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
  <title>Pilapse - Raspberry Pi Camera and Timelapse - PR</title>
  <meta property="og:title" content="Pilapse - Raspberry Pi Camera and Timelapse - PR" />
  <meta name="twitter:title" content="Pilapse - Raspberry Pi Camera and Timelapse - PR" />
  <meta name="description" content="It is a simple python script to capture timelapse with few more addition option than raspistill -tl.
Built-in command usage: raspistill -t 30000 -tl 2000 -o image%04d.">
  <meta property="og:description" content="It is a simple python script to capture timelapse with few more addition option than raspistill -tl.
Built-in command usage: raspistill -t 30000 -tl 2000 -o image%04d.">
  <meta name="twitter:description" content="It is a simple python script to capture timelapse with few more addition option than raspistill -tl.
Built-in command usage: raspistill -t 30000 -tl 2000 -o image%04d.">
  <meta name="author" content="Palani Raja"/>
  <meta property="og:site_name" content="PR" />
  <meta property="og:url" content="https://www.palaniraja.com/2018/07/pilapse---raspberry-pi-camera-and-timelapse/" />
  <meta property="og:type" content="article" />
  <meta name="twitter:card" content="summary" />
  <meta name="generator" content="Hugo 0.44" />
  
  <link rel="stylesheet" href="https://www.palaniraja.com/css/milligram.css" media="all" />
  <link rel="stylesheet" href="https://www.palaniraja.com/css/style.css" media="all" />
  
  
   <style type="text/css">
   </style>
</head>

<body>

<header class="site-header">
  <nav class="site-navi">
    <h1 class="site-title"><a href="https://www.palaniraja.com/">PR</a></h1>
    <ul class="site-navi-items">
      <li class="site-navi-item-projects"><a href="https://www.palaniraja.com/projects" title="Projects">Projects</a></li>
      <li class="site-navi-item-blog"><a href="https://www.palaniraja.com/posts" title="Blog">Blog</a></li>
      <li class="site-navi-item-archive"><a href="https://www.palaniraja.com/archives" title="Archive">Archive</a></li>
      <li class="site-navi-item-about"><a href="https://www.palaniraja.com/about" title="About">About</a></li>
    </ul>
  </nav>
</header>
<hr class="site-header-bottom">

  <div class="main" role="main">
    <article class="article">
      <ul class="article-meta">
        <li class="article-meta-date"><time>Jul 28, 2018 </time>  &nbsp;&nbsp;<small> &minus; 2 <em>min.</em> read</small></li>
        
        
      </ul>
      
      

      
        <h1 class="article-title">Pilapse - Raspberry Pi Camera and Timelapse</h1>
      
      
      
      <hr class="article-title-bottom">
      
      
      
      

<p>It is a simple python script to capture timelapse with few more addition option than <a href="https://www.raspberrypi.org/documentation/usage/camera/raspicam/raspistill.md"><code>raspistill -tl</code></a>.</p>

<p>Built-in command usage: <code>raspistill -t 30000 -tl 2000 -o image%04d.jpg</code></p>

<p>I wrote  <code>pilapse.py</code> because I need to manage the quality <code>-q</code> and <code>W x H</code> which <code>-tl</code> flag does not support. Along with configurable delay between each pictures and when to stop based on available freespace on disk.</p>

<p>Find my first successful timelapse using this script below. Sorry for the orientation.</p>

<figure>
  <a href="https://www.youtube.com/watch?v=7X7YW2372Qk" title="Youtube link" target="_blank"> <img src="https://img.youtube.com/vi/7X7YW2372Qk/maxresdefault.jpg" alt="thumbnail of video" /> </a>  
  <figcaption> <a class="external-links" target="_blank" href="https://www.youtube.com/watch?v=7X7YW2372Qk">https://www.youtube.com/watch?v=7X7YW2372Qk</a></figcaption>
</figure>



<figure>
  <a href="https://www.youtube.com/watch?v=pzTujxJvKDo" title="Youtube link" target="_blank"> <img src="https://img.youtube.com/vi/pzTujxJvKDo/maxresdefault.jpg" alt="thumbnail of video" /> </a>  
  <figcaption> <a class="external-links" target="_blank" href="https://www.youtube.com/watch?v=pzTujxJvKDo">https://www.youtube.com/watch?v=pzTujxJvKDo</a></figcaption>
</figure>



<h4 id="hardware-used">Hardware used:</h4>

<ul>
<li>Raspberry Pi Zero W</li>
<li>Pi Camera module v1.2 (unofficial)</li>
<li>Official Pi Zero camera case (white/red)</li>
<li>MI - 10000 mAh Battery pack</li>
<li>212 images of 15 sec interval (~53 minutes)</li>
</ul>

<h4 id="stiching-timelapse-video">Stiching timelapse video:</h4>

<p>Files were later copied to a mac, batch renamed later as</p>

<ul>
<li>image0.jpg</li>
<li>image1.jpg</li>
<li>&hellip;</li>
<li>image100.jpg</li>
</ul>

<p>And used the following command to convert to video</p>

<p><code>avconv -r 10 -i image%d.jpg -r 10 -vcodec libx264 -vf scale=1440:1080 timelapse.mp4</code></p>

<p><strong>Note:</strong> While renaming be aware of natural order sorting (<a href="http://hints.macworld.com/article.php?story=20030724161328982">ref</a>). Finder batch rename messed few times, so always check the images are in correct sequence.</p>

<h4 id="script-pilapse-py">Script: <code>pilapse.py</code></h4>

<!-- <noscript>
    <p class="noscript">Content requires Javascript to be enabled.</p>

    <p><a href="https://gist.github.com/palaniraja/a0ee100dec5a7dbd6a704c51adb96ba2">https://gist.github.com/palaniraja/a0ee100dec5a7dbd6a704c51adb96ba2</a> </p>

    <br/>
    
</noscript>
<style type="text/css">
    p.noscript{
        background-color: #fefea0;
        border-left: 4px solid #fea0a0;
        padding: 0 0.25em;
    }
</style> -->

<!-- <script src="//gist.github.com/palaniraja/a0ee100dec5a7dbd6a704c51adb96ba2.js"></script> -->

<pre><code>#!/usr/bin/python
import os
import time
import subprocess
from time import sleep
import random


# Configuration 

sleepDurationInSeconds = 15
checkDiskSpaceEveryImage = 20

rand = random.randint(0,10000)
# &quot;echo \&quot;SEQ-$RANDOM-$(ls | wc -l)-\&quot;&quot;
numFiles = subprocess.check_output(&quot;echo $(ls | wc -l)&quot;, shell=True)


randPrefix = &quot;SEQ-&quot;+str(rand)+&quot;-&quot;+str(numFiles).strip()


imgSeq = 0
shouldAbort = False

print &quot;Timelapse started. Capture image every &quot;+str(sleepDurationInSeconds)+&quot; sec. Check Free Space every &quot;+str(checkDiskSpaceEveryImage)+&quot; images.&quot;

while (shouldAbort != True):
    # Every x seconds
    sleep(sleepDurationInSeconds)
    ts = time.strftime(&quot;%Y%m%d%H%M%S&quot;)
    imgName = randPrefix+&quot;-&quot;+str(imgSeq)+&quot;-&quot;+ts
    print imgName

    os.system(&quot;raspistill -t 2000 -n -q 100 -vf -hf -w 1440 -h 1080 -o &quot;+imgName+&quot;.jpg&quot;)

    imgSeq += 1
    # Quit after x images
    # if (imgSeq &gt; 10):
    #     shouldAbort = True


    # Check freespace every x seconds
    if (imgSeq % checkDiskSpaceEveryImage == 0):
        dfOut = subprocess.check_output(&quot;df | grep root| awk '{print $4}'&quot;, shell=True)
        freespace = int(dfOut.strip())
        # less than 1G
        if (freespace &lt; 1000000):
            print &quot;Low on space, exiting timelapse&quot;
            shouldAbort = True

print &quot;Timelapse completed.&quot;
</code></pre>

<p>Latest version of the script can be found at <a class="external-links" target="_blank" href="https://gist.github.com/palaniraja/a0ee100dec5a7dbd6a704c51adb96ba2">https://gist.github.com/palaniraja/a0ee100dec5a7dbd6a704c51adb96ba2</a></p>


      
    </article>

    
    <hr style="border-color:#4484ce44;"/>
    
    
      

        <a class="button" href="https://docs.google.com/forms/d/e/1FAIpQLSfYu6LCtDC4q0pxinkTJLLY9u-ATk_HQyqU6A8LzNmuNplohw/viewform?usp=pp_url&entry.1500707377=https%3a%2f%2fwww.palaniraja.com%2f2018%2f07%2fpilapse---raspberry-pi-camera-and-timelapse%2f" title="Link to Google Forms">Post Comment</a> 
      
      

      

        
        
        

    <hr  style="border-color:transparent;"/>
    
    <ul class="pager article-pager">
      <li class="pager-newer">
          <a href="https://www.palaniraja.com/2018/08/dropbox-mac---deletes-files-on-reinstallation/" data-toggle="tooltip" data-placement="top" title="Recent Article">&lt; Dropbox Mac - Deletes files on reinstallation?</a>
      </li>
      <li class="pager-older">
        <a href="https://www.palaniraja.com/2018/06/merging-multiple-mp4-videos-with-ffmpeg/" data-toggle="tooltip" data-placement="top" title="Previous Article">Merging multiple MP4 videos with FFMPEG &gt;</a>
      </li>
    </ul>
  </div>


<div class="site-footer-invalid">

  

  <p align="center" class="nav-footer-menu">
    
    
      <a href="https://www.palaniraja.com/" title="Home">Home</a> 
      <a href="https://www.palaniraja.com/index.xml" title="RSS">RSS</a> 
      <a href="https://www.palaniraja.com/archives/" title="Archive">Archive</a> 
      <a href="https://www.palaniraja.com/categories/" title="Categories">Categories</a> 
      <a href="https://www.palaniraja.com/tags/" title="Tags">Tags</a> 
      <a href="https://www.palaniraja.com/devdiary/" title="DevDiary">DevDiary</a> 
      <a href="https://www.palaniraja.com/about/" title="About">About</a> 
  </p>

  <p align="center">&copy; 2018 palaniraja</p>
</div>

</body>
</html>
